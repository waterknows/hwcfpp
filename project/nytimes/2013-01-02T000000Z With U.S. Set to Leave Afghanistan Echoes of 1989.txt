WASHINGTON — The young president who ascended to office as a change agent decides to end the costly and unpopular war in Afghanistan. He seeks an exit with honor by pledging long-term financial support to allies in Kabul, while urging reconciliation with the insurgency. But some senior advisers lobby for a deliberately slow withdrawal, and propose leaving thousands of troops behind to train and support Afghan security forces.This is a nearly exact description of the endgame conundrum facing President Obama as he prepares for a critical visit by Hamid Karzai, the Afghan president, planned for early January.But the account is actually drawn from declassified Soviet archives describing Mikhail S. Gorbachev’s closed-door struggles with his Politburo and army chiefs to end the Kremlin’s intervention in Afghanistan — one that began with a commando raid, coup and modest goals during Christmas week of 1979 but became, after a decade, what Mr. Gorbachev derided as “a bleeding wound.”What mostly is remembered about the withdrawal is the Soviet Union’s humiliation, and the ensuing factional bloodletting across Afghanistan that threw the country into a vicious civil war. It ended with Taliban control and the establishment of a safe haven for Al Qaeda before the terrorist attacks on Sept. 11, 2001.But scholars who have studied the Soviet archives point out another lesson for the Obama administration as it manages the pullout of American and allied combat forces from Afghanistan by the end of 2014.“The main thing the Soviets did right was that they continued large-scale military assistance to the regime they left behind after the final withdrawal in ’89,” said Mark N. Katz, a professor at George Mason University and author of “Leaving Without Losing: The War on Terror After Iraq and Afghanistan” (Johns Hopkins University Press, 2012).“As long as the Afghan regime received the money and the weapons, they did pretty well — and held on to power for three years,” Mr. Katz said. The combat effectiveness of Kabul’s security forces increased after the Soviet withdrawal, when the fight for survival become wholly their own.But then the Soviet Union dissolved in December 1991, and the new Russian leader, Boris N. Yeltsin, heeded urgings of the United States and other Western powers to halt aid to the Communist leadership in Afghanistan, not just arms and money, but also food and fuel. The Kremlin-backed government in Kabul fell three months later.To be sure, there are significant contrasts between the two interventions in Afghanistan. The Soviet invasion and occupation were condemned as illegal aggression, while the American one was embraced by the international community, including Russia, as a “just war,” one with limited goals of routing the Taliban and eliminating Al Qaeda. That war of necessity has since evolved into a war of choice, one the Obama administration is working to end as quickly as is feasible.Despite the differences going in, both the Soviet Union and the United States soon learned that Afghanistan is a land where foreigners aspiring to create nations in their image must combat not just the Taliban but tribalism, orthodoxy, corruption and a medieval view of women. As well, Pakistan has had interests at odds with those of the neighboring government in Afghanistan, whether Kabul was an ally of Moscow or of Washington.“The Soviet Union did not understand religious and ethnic factors sufficiently, and overestimated the capacity of Afghan society to move very fast toward a modern era, in this case socialism,” said Svetlana Savranskaya, director of Russian programs at the National Security Archive, an independent research center at George Washington University.“Here I see similarities with the approach of the United States, especially with all the discussion about trying to leave behind an Afghanistan that is democratic and respects the rights of women, ideas that simply are not accepted across the broad society there,” said Ms. Savranskaya, who has written extensively on the Soviet archives.If the Soviet experience offers any guidance to the current American withdrawal, she said, it would be to accelerate the departure of foreign combat forces — but to leave in their place a “sustained, multiyear international involvement in military training, education and civilian infrastructure projects, and maybe not focusing on building democracy as much as improving the lives of the common people.”And she noted that the United States should already be seeking partnership with Afghan leaders beyond Mr. Karzai, who is viewed across large parts of the population as tainted by his association with the Americans.Pentagon officials have signaled that they are hoping for an enduring military presence of 10,000 or more troops, but may have to accept fewer, to cement the progress of the years of fighting. Those troops would focus on training and supporting Afghan forces along with a counterterrorism contingent to hunt Qaeda and insurgent leaders.In a parallel, one of Mr. Gorbachev’s closest early confidants, Eduard A. Shevardnadze, the foreign minister, advocated a slow withdrawal pace — and pressed for 10,000 to 15,000 Soviet troops to remain to support the Communist government. The Soviets left only 300 advisers.But after losing more than 15,000 Soviet troops and billions of rubles, the Kremlin knew it had to somehow justify the invasion and occupation upon withdrawal.Mr. Gorbachev had “to face up to a difficult problem of domestic politics which has puzzled other nations finding themselves in similar circumstances,” Rodric Braithwaite, a former British ambassador to Moscow, wrote in “Afgantsy” (Oxford University Press, 2011), his book on the Soviet intervention based on Communist Party documents.“How could the Russians withdraw their army safely, with honor, without looking as if they were simply cutting and running, and without appearing to betray their Afghan allies or their own soldiers who had died?” Mr. Braithwaite wrote of the internal Kremlin debate, in terms resonant of the Americans’ conundrum today.Around the time of the Soviet withdrawal, an article by Pravda, the Communist Party mouthpiece, clutched for a positive view as the Soviet Army pulled out. Read today, it bears a resemblance to the news releases churned out by the Pentagon detailing statistics on reconstruction assistance.“Soviet soldiers in Afghanistan repaired, rebuilt and constructed hundreds of schools, technical colleges, over 30 hospitals and a similar number of nursery schools, some 400 apartment buildings and 35 mosques,” the article said. “They sank dozens of wells and dug nearly 150 kilometers of irrigation ditches and canals. They were also engaged in guarding military and civilian installations in trouble.”The Kremlin had learned that its armies could not capture political success, but Soviet commanders made the same claims upon withdrawal that are heard from NATO officers today: not a single battlefield engagement was lost to guerrillas, and no outpost ever fell to insurgents.That understanding seemed to animate Defense Secretary Leon E. Panetta as he toured Afghanistan recently in a traditional holiday visit with the troops.At each stop, Mr. Panetta acknowledged that significant challenges remain to an orderly withdrawal and a stable postwar Afghanistan, and not just the resilient insurgency.He cited unreliable Afghan governance, continuing corruption and the existence of insurgent safe havens in Pakistan. None of those are likely to be fixed with American firepower.