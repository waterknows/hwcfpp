KABUL, Afghanistan —  The Obama administration had hoped that after years of frustration with President Hamid Karzai, a successful election in Afghanistan would finally produce a leader who could stabilize the country while working with the United States to allow an orderly withdrawal of American troops and end its longest war.Yet nearly a month after a runoff election to choose Afghanistan’s next president, Secretary of State John Kerry arrived here on Friday for a hastily arranged visit aimed at resolving a crisis that began with allegations of widespread vote rigging. It now threatens to fracture Afghanistan’s fragile government as American-led combat troops are preparing to complete their withdrawal.Both candidates, Abdullah Abdullah and Ashraf Ghani, have acknowledged that fraud marred the election, and yet each campaign has claimed victory, with Mr. Abdullah this week threatening to declare himself president, raising the specter of an ethnically and regionally divided Afghanistan.“If Abdullah goes for it and declares himself president, forget it, this is over,” said a former Afghan official who remains close to many of Afghanistan’s top security officials. “Fighting the Taliban won’t even be an issue because who is going to do it? The army will be split. So will the police.”Overshadowed by the events in Iraq, the swift deterioration of the political situation here has, in a matter of weeks, moved Afghanistan dangerously close to a situation far worse than that envisioned as likely by many American and Afghan officials before the election. Some Western officials have begun to warn that the crisis poses a greater immediate threat to the Afghan government than the Taliban.The prospect that Mr. Abdullah, who has the support of many powerful former warlords, might try to seize control prompted American and European officials to threaten in recent days that foreign troops could be pulled out and billions of dollars in essential aid lost if the crisis was not peacefully resolved.It also spurred the Obama administration this week to begin moving off its long-held position that the election was an issue for Afghans to work out among themselves: President Obama called both candidates, and Mr. Kerry added a stop to Afghanistan on a trip he was making to Asia.American officials said Friday that standing on the sidelines risked the possible fracturing of a government the United States had spent billions to build and sacrificed thousands of troops to defend. Current and former Afghan officials concurred, stressing that a solution was still possible, but that time was running out.Adding to the complications faced by Mr. Kerry, salvaging the Afghan election means working with the person the Obama administration is most eager to see gone: Mr. Karzai.The Afghan leader remains powerful even as a lame duck, and his support is crucial to any deal that could end the crisis. Although Mr. Karzai has sought to remain publicly above the fray, Afghan officials close to him have said he has shaped the election process in favor of Mr. Ghani, a longtime adviser and former finance minister who held a commanding lead in preliminary results released on Monday.The Abdullah campaign has accused Mr. Karzai of rigging the election, a charge he denies.Mr. Kerry is one of the few American officials with whom Mr. Karzai still enjoys a relatively warm relationship. Yet it is tainted by Mr. Karzai’s bitterness over the last presidential election, in 2009, during which he believes the United States tried to engineer his removal. That vote was similarly riddled with fraud, and it was Mr. Kerry who persuaded Mr. Karzai to agree to a runoff that year, which the Afghan leader saw as a humiliation.Mr. Karzai’s challenger in 2009 was Mr. Abdullah, a former foreign minister who eventually dropped out of the race. And though American mediation averted a crisis at the time, it left both Mr. Karzai and Mr. Abdullah mistrustful of the United States.Overcoming those sentiments is necessary for Mr. Kerry to have any chance of brokering an end to the crisis. But the United States has far less leverage than it did in 2009. After years of watching American officials fold after being rebuffed by Mr. Karzai, few here give much credence to American threats to pull out troops and cut aid. And each successive crisis over election fraud — this year’s is the third in five years, including the parliamentary elections in 2010 — has diminished the faith of many Afghans in the government erected by the United States.“The Americans have been here for 13 years, and what is the result? This system is a mess,” said Noor Azizi, 24, a marketing officer who was among about 40 protesters, some of them in a human chain blocking the entrance to Kabul’s airport on Friday.Another protester, Mustafa Sattari, a doctoral student, said, “We want the international community to take action, and we want real democracy.”Mr. Kerry met separately on Friday with Mr. Karzai, Mr. Abdullah and Mr. Ghani. The focus was on the technical aspects of the election process, specifically on seeking an audit of votes suspected to be fraudulent, an issue at the center of the deadlock.A senior aide to Mr. Abdullah said the candidate left his meeting with the sense he had finally gotten a fair hearing after weeks of being told by Western officials to respect a process that he believes is irredeemably tainted in Mr. Ghani’s favor.Mr. Kerry “listened to our proposals, and his reaction was, ‘These make sense,’ ” said the aide, who had spoken with Mr. Abdullah about the meeting.“I found him more optimistic,” the aide said of Mr. Abdullah. “Cautious, but not without hope.”Supporters of Mr. Ghani were similarly positive after he met with Mr. Kerry. Daud Sultanzoy, a former presidential candidate who joined Mr. Ghani’s campaign in April, insisted that his candidate had won and that he had discussed ways of forming as inclusive a government as possible.But Mr. Sultanzoy said Mr. Ghani had reiterated to Mr. Kerry his opposition to a unity government with Mr. Abdullah, who has also said he is not interested in such an arrangement.Despite the relative optimism, the gap between the candidates remained wide after Friday’s meetings.Mr. Kerry, in comments to reporters on Friday morning, seemed aware of the tough challenge he faced, cautioning that there was no guarantee of success.“The future potential of a transition hangs in the balance, so we have a lot of work to do,” he said before a meeting with Jan Kubis, the special United Nations envoy for Afghanistan.The election crisis began almost as soon as voting ended in the June 14 runoff, with the Abdullah campaign alleging large-scale fraud that benefited Mr. Ghani. Mr. Ghani’s camp has accused Mr. Abdullah’s supporters of fraud, but with officials saying that Mr. Ghani is ahead, it has been far less vociferous.At the start of the week, the two sides were talking about an audit that would be acceptable to both. Then Afghanistan’s Independent Election Commission announced preliminary results that appeared to confirm what Afghan officials had been privately saying: Mr. Ghani was leading by roughly one million votes.The announcement was made over the objections of the Abdullah campaign and Western officials, and the lopsided results helped breathe new life into the crisis, cutting off direct talks between the candidates.The development also led powerful Abdullah supporters to start calling for him to seize power.Mr. Abdullah “is in a very difficult position,” said the senior aide, who asked not to be identified so he could discuss internal campaign deliberations. “He has been under a lot of pressure from people who are saying you don’t have to trust the U.N., you don’t have to trust the U.S., remember what happened in the past.”